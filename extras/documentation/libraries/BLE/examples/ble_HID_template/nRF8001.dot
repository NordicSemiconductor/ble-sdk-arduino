/* (graphviz)
dot nRF8001.dot -Tpng -o nRF8001_HID_app_states.png */
digraph G {
    subgraph cluster_start {
        START_STATE [label="START"]
    }
    
    {
        rank=same; ACI_DEVICE_SLEEP; ACI_DEVICE_SETUP;
    }
    {
        rank=same; ACI_DEVICE_STANDBY;
    }
    {
        rank=same; bond_data_read_store; bond_data_restore;
    }

    subgraph cluster_bonded {
        node [style=filled, color=lightblue];
        label = "BONDED";
        bonded -> pipe_available [label="ACI Evt Pipe Status/\nACI Change Timing Request(Timing)"]; /* Wait ->Win 8 HID over GATT client to enable the HID Report by writing to the 
                                                                                                    Client Configuration Characteristic Descriptor (CCCD) of the HID Report*/
        bonded -> pipe_available [label="ACI Evt Pipe Status/\nACI Send Data (HID Report)"];
        pipe_available -> pipe_available [label="ACI Evt Credit/\nACI Send Data (HID Report)"];
        ACI_DEVICE_STANDBY [style=solid, color=black, fontsize=30]
    }
    
    /* Event/Action */
    
    START_STATE -> ACI_DEVICE_INVALID [label="pin reset nRF8001"]
    ACI_DEVICE_INVALID -> ACI_DEVICE_SETUP [label="<using services_lock.h - Setup for nRF8001 is in RAM>\nACI Evt Device Started(Setup)/\nACI Setup in do_setup"];
    
    ACI_DEVICE_INVALID -> ACI_DEVICE_STANDBY [label="<using services_lock.h - Setup for nRF8001 is in OTP>\n ACI Evt Device Started(Standby)"];
    
    ACI_DEVICE_SETUP -> ACI_DEVICE_SETUP [label="ACI Setup in do_setup()"];   /* do_setup uses the Setup messages generated by the nRFgo Studio in services.h or services_lock.h */
    ACI_DEVICE_SETUP -> ACI_DEVICE_STANDBY [label="ACI Evt Device Started(Standby)"];
    ACI_DEVICE_STANDBY -> ACI_DEVICE_STANDBY [label="EEPROM does not have valid bond_data/\nACI Bond"];    
    ACI_DEVICE_STANDBY -> bonded [label="ACI Evt Connected, \nACI Evt Bond Status(Success)"];    

    bonded -> bond_data_read_store [label="ACI Evt Disconnected(Link Lost), bonded_first_time==true\n/ACI Read Dynamic Data"];
    bond_data_read_store -> ACI_DEVICE_STANDBY [label="ACI Evt Command Response\n(ACI Read Dynamic Data, TRANSACTION_COMPLETE)/\nbonded_first_time= false, ACI Connect"];
        
    ACI_DEVICE_STANDBY -> bond_data_restore [label="EEPROM has valid bond_data/\nACI Write Dynamic Data"];
    bond_data_restore  -> ACI_DEVICE_STANDBY [label="ACI Evt Command Response\n(ACI Write Dynamic Data, TRANSACTION_COMPLETE)/\nACI Connect"];




    ACI_DEVICE_STANDBY -> ACI_DEVICE_SLEEP [label="ACI Evt Disconnected\n(Advertising timed out)/ACI Sleep, MCU Sleep"];
    ACI_DEVICE_SLEEP -> ACI_DEVICE_INVALID [label="Button Press/\nACI Wakeup"]   /* ACI Wakeup will generate a ACI Evt DeviceStarted(Setup) when Setup is in RAM */
                                                                                 /* ACI Wakeup will generate a ACI Evt DeviceStarted(Setup) when Setup is in OTP */

}